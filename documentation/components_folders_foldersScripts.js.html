<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/folders/foldersScripts.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/folders/foldersScripts.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import fs from 'fs';

import {
	getDirectories,
	handleSetToast,
	getUIIgnoreArr,
} from '../../assets/js/utils/scripts';
import { selectDirApi } from '../../assets/js/utils/ipcRenderer';
import { store } from '../../store/configureStore';

export const chokidarVars = {
	chokidarWatcher: null,
	chokidarConfig: (src, ignore) => ({
		ignored: [...getUIIgnoreArr(src, ignore)],
		awaitWriteFinish: {
			stabilityThreshold: 2000,
			pollInterval: 100,
		},
		ignorePermissionErrors: true,
	}),
};

export const handleToggleFoldersVisible = foldersVisible => ({
	foldersVisible: !foldersVisible,
});

/**
 * Check if a new folder will be opened
 * @param {*} prev_workspace
 * @param {*} workspace
 * @returns true if a new folder will be opened, otherwise false
 */
export const shouldSwitchFolder = (prev_workspace, workspace) => {
	if (
		Object.keys(workspace?.projects ? workspace?.projects : {}).length ===
		Object.keys(prev_workspace?.projects ? prev_workspace?.projects : {})
			.length
	) {
		let notEqual = false;

		Object.keys(workspace?.projects ? workspace?.projects : {}).forEach(
			name => {
				if (
					workspace.projects[name]?.open !==
					prev_workspace.projects[name]?.open
				) {
					notEqual = true;
				}
			},
		);

		Object.keys(
			prev_workspace?.projects ? prev_workspace?.projects : {},
		).forEach(name => {
			if (
				workspace.projects[name]?.open !==
				prev_workspace.projects[name]?.open
			) {
				notEqual = true;
			}
		});

		return notEqual;
	}
	return true;
};

/**
 *
 * @param {*} arr
 * @param {*} base
 * @param {*} isFile
 */
const fsToJson = (arr, base, isFile) => {
	let nestedArr = base;
	let pathToDir = '';

	arr.forEach((asset, i) => {
		let index;

		nestedArr &amp;&amp;
			nestedArr.forEach((obj, i) => {
				if (obj.label === asset) {
					index = i;
				}
			});

		if (index === undefined &amp;&amp; nestedArr) {
			if (i === arr.length - 1 &amp;&amp; isFile) {
				nestedArr.push({
					className: 'folder',
					id: `${pathToDir}/${asset}`,
					icon: 'document',
					label: asset,
				});
			} else {
				nestedArr.push({
					className: 'folder',
					id: `${pathToDir}/${asset}`,
					hasCaret: true,
					isExpanded: true,
					icon: 'folder-open',
					label: asset,
					childNodes: [],
				});
			}
		}

		pathToDir += `/${asset}`;
		nestedArr = nestedArr
			? nestedArr[index === undefined ? 0 : index]?.childNodes
			: [];
	});
};

/**
 * get root
 * @param {*} folder_json_model
 * @param {*} root
 * @returns node
 */
export const getRoot = (folder_json_model, root) => {
	root = root.split('/');
	root = root[root.length - 1];

	while (Array.isArray(folder_json_model)) {
		const lastNode = folder_json_model[folder_json_model.length - 1];

		if (lastNode?.label === root) {
			return lastNode;
		}
		folder_json_model = lastNode?.childNodes;
	}
};

/**
 * Function to switch between different folders
 * @returns path to the new folder
 */
export const selectFolderStructureRootPath = async () => {
	selectDirApi.selectDir('select-dir');

	const path = await new Promise((resolve, reject) => {
		selectDirApi.registerListener('selected-dir', value => {
			if (value) {
				resolve(value);
			} else {
				reject();
			}
		});
	}).catch(() => {
		console.log("can't select workspace path"); // eslint-disable-line no-console
	});

	return { path };
};

/**
 * Function to create folder json model
 * @param {Object} obj
 * @param {Function} callback
 */
export const createFolderJsonModel = async (obj, callback) => {
	const { path: root_path } = obj;
	const uiIgnoreArr = getUIIgnoreArr(
		'',
		store.getState().settings.uiIgnore,
	).map(str => str.split('/')[2]);

	if (root_path) {
		const paths = await getDirectories(root_path).catch(() => {});

		let counter = 0;
		const folder_json_model = [];
		let failed;

		if (Array.isArray(paths)) {
			paths.forEach(async path => {
				const stats = await new Promise((resolve, reject) => {
					fs.stat(path, (err, stats) => {
						if (!err) {
							resolve(stats);
						} else {
							reject(err);
						}
					});
				}).catch(() => {
					failed = true;
				});

				counter += 1;

				const isFile = stats ? stats.isFile() : null;
				const arr = path.split('/').filter(value => !!value);

				if (
					uiIgnoreArr.filter(str => !!arr.includes(str)).length === 0
				) {
					fsToJson(arr, folder_json_model, isFile);
				}

				if (counter === paths.length) {
					const root = getRoot(folder_json_model, root_path);
					callback([root], root_path);
				}
			});

			if (failed) {
				handleSetToast({
					icon: 'warning-sign',
					intent: 'danger',
					message:
						'error opening folder. Make sure that this folder is healthy then try again.',
				});
			}
		}
	}
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addRemoveKeyDownKeyUpEvent">addRemoveKeyDownKeyUpEvent</a></li><li><a href="global.html#addToQueue">addToQueue</a></li><li><a href="global.html#addToScriptsQueue">addToScriptsQueue</a></li><li><a href="global.html#areResultsEqual">areResultsEqual</a></li><li><a href="global.html#closeDialog">closeDialog</a></li><li><a href="global.html#closeFile">closeFile</a></li><li><a href="global.html#collectSettingsValues">collectSettingsValues</a></li><li><a href="global.html#constructInputToWrite">constructInputToWrite</a></li><li><a href="global.html#constructOutputToWrite">constructOutputToWrite</a></li><li><a href="global.html#contructQueryWithPath">contructQueryWithPath</a></li><li><a href="global.html#countQueries">countQueries</a></li><li><a href="global.html#createFolderJsonModel">createFolderJsonModel</a></li><li><a href="global.html#discardDialogHandler">discardDialogHandler</a></li><li><a href="global.html#editorDidMount">editorDidMount</a></li><li><a href="global.html#editorShouldGoToLine">editorShouldGoToLine</a></li><li><a href="global.html#extractLanguageFromString">extractLanguageFromString</a></li><li><a href="global.html#extractWorkSpaceNameAndActiveProject">extractWorkSpaceNameAndActiveProject</a></li><li><a href="global.html#forEachNode">forEachNode</a></li><li><a href="global.html#forNodeAtPath">forNodeAtPath</a></li><li><a href="global.html#fsToJson">fsToJson</a></li><li><a href="global.html#generateScriptImportQuery">generateScriptImportQuery</a></li><li><a href="global.html#getEditorFilesFromOpenFiles">getEditorFilesFromOpenFiles</a></li><li><a href="global.html#getExtension">getExtension</a></li><li><a href="global.html#getFolderStructureRootPathFromWorkspace">getFolderStructureRootPathFromWorkspace</a></li><li><a href="global.html#getOpenFileName">getOpenFileName</a></li><li><a href="global.html#getResultObjWithPostQueryKey">getResultObjWithPostQueryKey</a></li><li><a href="global.html#getRoot">getRoot</a></li><li><a href="global.html#getScriptResult">getScriptResult</a></li><li><a href="global.html#getSettingsInitialValues">getSettingsInitialValues</a></li><li><a href="global.html#getUIIgnoreArr">getUIIgnoreArr</a></li><li><a href="global.html#getWindowHeight">getWindowHeight</a></li><li><a href="global.html#goToLine">goToLine</a></li><li><a href="global.html#handleAddQueryToHistory">handleAddQueryToHistory</a></li><li><a href="global.html#handleAPIQueryError">handleAPIQueryError</a></li><li><a href="global.html#handleCloseProject">handleCloseProject</a></li><li><a href="global.html#handleDeleteProject">handleDeleteProject</a></li><li><a href="global.html#handleDiscard">handleDiscard</a></li><li><a href="global.html#handleEditorOnChange">handleEditorOnChange</a></li><li><a href="global.html#handleEmptyWorkspace">handleEmptyWorkspace</a></li><li><a href="global.html#handleFontSizeChange">handleFontSizeChange</a></li><li><a href="global.html#handleInitialTableWidth">handleInitialTableWidth</a></li><li><a href="global.html#handleInsertELementToCircuitUIResponseNode">handleInsertELementToCircuitUIResponseNode</a></li><li><a href="global.html#handleMaximize">handleMaximize</a></li><li><a href="global.html#handleMouseDown">handleMouseDown</a></li><li><a href="global.html#handleMouseOut">handleMouseOut</a></li><li><a href="global.html#handleMouseOver">handleMouseOver</a></li><li><a href="global.html#handleMove">handleMove</a></li><li><a href="global.html#handleOnChange">handleOnChange</a></li><li><a href="global.html#handleOpenFile">handleOpenFile</a></li><li><a href="global.html#handleOpenProject">handleOpenProject</a></li><li><a href="global.html#handleResize">handleResize</a></li><li><a href="global.html#handleSave">handleSave</a></li><li><a href="global.html#handleScrollTop">handleScrollTop</a></li><li><a href="global.html#handleShortcut">handleShortcut</a></li><li><a href="global.html#handleSuggestionClick">handleSuggestionClick</a></li><li><a href="global.html#handleSwitchWorkspace">handleSwitchWorkspace</a></li><li><a href="global.html#handleTerminalToggle">handleTerminalToggle</a></li><li><a href="global.html#handleToggleAllBlocks">handleToggleAllBlocks</a></li><li><a href="global.html#handleToggleAllSubBlocks">handleToggleAllSubBlocks</a></li><li><a href="global.html#handleToggleBlock">handleToggleBlock</a></li><li><a href="global.html#handleToggleSubBlock">handleToggleSubBlock</a></li><li><a href="global.html#handleWebSocketResponse">handleWebSocketResponse</a></li><li><a href="global.html#handleWriteQuery">handleWriteQuery</a></li><li><a href="global.html#handleWriteQueryResult">handleWriteQueryResult</a></li><li><a href="global.html#handleWriteScriptQuery">handleWriteScriptQuery</a></li><li><a href="global.html#handleWriteToCircuitUIInput">handleWriteToCircuitUIInput</a></li><li><a href="global.html#handleWriteToCircuitUIResponse">handleWriteToCircuitUIResponse</a></li><li><a href="global.html#highlightRange">highlightRange</a></li><li><a href="global.html#initCircuitUI">initCircuitUI</a></li><li><a href="global.html#initShortcuts">initShortcuts</a></li><li><a href="global.html#initXterm">initXterm</a></li><li><a href="global.html#isCtrlKeyPressed">isCtrlKeyPressed</a></li><li><a href="global.html#isCtrlKeyUnpressed">isCtrlKeyUnpressed</a></li><li><a href="global.html#isFilePathInQueryResult">isFilePathInQueryResult</a></li><li><a href="global.html#isLineNumberInQueryResult">isLineNumberInQueryResult</a></li><li><a href="global.html#isQueryResultToOpenSynthFile">isQueryResultToOpenSynthFile</a></li><li><a href="global.html#isScriptQueryResultToOpenSynthFile">isScriptQueryResultToOpenSynthFile</a></li><li><a href="global.html#modifyWorkSpaceNameAndActiveProject">modifyWorkSpaceNameAndActiveProject</a></li><li><a href="global.html#mouseTrapGlobalBindig">mouseTrapGlobalBindig</a></li><li><a href="global.html#nFormatter">nFormatter</a></li><li><a href="global.html#openEmptyFile">openEmptyFile</a></li><li><a href="global.html#openProjectExists">openProjectExists</a></li><li><a href="global.html#openShortcutsPage">openShortcutsPage</a></li><li><a href="global.html#openSyntheticFile">openSyntheticFile</a></li><li><a href="global.html#parseKeyBinding">parseKeyBinding</a></li><li><a href="global.html#parseProject">parseProject</a></li><li><a href="global.html#parseProjects">parseProjects</a></li><li><a href="global.html#parseScriptReportJSON">parseScriptReportJSON</a></li><li><a href="global.html#performDeQueueQuery">performDeQueueQuery</a></li><li><a href="global.html#performEnQueueQuery">performEnQueueQuery</a></li><li><a href="global.html#performPeekQueue">performPeekQueue</a></li><li><a href="global.html#performPostQuery">performPostQuery</a></li><li><a href="global.html#performPushResult">performPushResult</a></li><li><a href="global.html#processFiles">processFiles</a></li><li><a href="global.html#processQueryResult">processQueryResult</a></li><li><a href="global.html#processScriptResult">processScriptResult</a></li><li><a href="global.html#refreshOpenFiles">refreshOpenFiles</a></li><li><a href="global.html#registerQueryShortcut">registerQueryShortcut</a></li><li><a href="global.html#removeShortcuts">removeShortcuts</a></li><li><a href="global.html#resizeHandler">resizeHandler</a></li><li><a href="global.html#runQueryWithArgs">runQueryWithArgs</a></li><li><a href="global.html#saveFile">saveFile</a></li><li><a href="global.html#selectFolderStructureRootPath">selectFolderStructureRootPath</a></li><li><a href="global.html#sendQueryResultToXTerm">sendQueryResultToXTerm</a></li><li><a href="global.html#sendWindowsMessage">sendWindowsMessage</a></li><li><a href="global.html#setQueryResult">setQueryResult</a></li><li><a href="global.html#setSuggestionBoxTrackerContent">setSuggestionBoxTrackerContent</a></li><li><a href="global.html#shouldAlertScriptRunSuccessful">shouldAlertScriptRunSuccessful</a></li><li><a href="global.html#shouldProcessQueryResult">shouldProcessQueryResult</a></li><li><a href="global.html#shouldRunQuery">shouldRunQuery</a></li><li><a href="global.html#shouldSwitchFolder">shouldSwitchFolder</a></li><li><a href="global.html#suggestQueryForXterm">suggestQueryForXterm</a></li><li><a href="global.html#suggestSimilarQueries">suggestSimilarQueries</a></li><li><a href="global.html#toggleScriptsArgsDialog">toggleScriptsArgsDialog</a></li><li><a href="global.html#unRegisterQueryShortcut">unRegisterQueryShortcut</a></li><li><a href="global.html#updateCursorPosition">updateCursorPosition</a></li><li><a href="global.html#updateData">updateData</a></li><li><a href="global.html#updateQueriesStats">updateQueriesStats</a></li><li><a href="global.html#withAPI">withAPI</a></li><li><a href="global.html#wsDisconnectFromServer">wsDisconnectFromServer</a></li><li><a href="global.html#wsReconnectToServer">wsReconnectToServer</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Wed Apr 20 2022 13:38:41 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
