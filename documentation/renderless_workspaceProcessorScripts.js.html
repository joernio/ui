<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: renderless/workspaceProcessorScripts.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: renderless/workspaceProcessorScripts.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { cpgManagementCommands as manCommands } from '../assets/js/utils/defaultVariables';
import {
	parseProject,
	parseProjects,
	handleSetToast,
} from '../assets/js/utils/scripts';

/**
 * modify space name and active project
 * @param {*} obj
 * @param {*} workspace
 * @returns workspace
 */
export const modifyWorkSpaceNameAndActiveProject = (obj, workspace) => {
	const {
		pathToWorkSpace,
		pathToProject,
		activeProjectName,
		inputPath,
		language,
	} = obj;
	workspace.path = pathToWorkSpace;

	Object.keys(workspace.projects).forEach(projectName => {
		if (projectName !== activeProjectName) {
			workspace.projects[projectName].open = false;
		}
	});

	if (activeProjectName) {
		let activeProject = workspace.projects[activeProjectName];
		activeProject = {
			inputPath,
			pathToProject,
			open: true,
			cpg: activeProject?.cpg,
			language: language || activeProject?.language,
		};
		workspace.projects[activeProjectName] = activeProject;
	}

	return workspace;
};

/**
 * extract workspace name and active project
 * @param {*} parsedProject
 * @returns workspace name
 */
export const extractWorkSpaceNameAndActiveProject = parsedProject => {
	const {
		name: activeProjectName,
		inputPath,
		path: pathToProject,
	} = parsedProject;

	const pathToWorkSpace = pathToProject
		? `${pathToProject.split('workspace')[0]}workspace`
		: null;

	return {
		pathToWorkSpace,
		pathToProject,
		activeProjectName,
		inputPath,
	};
};

/**
 * extract language from string
 * @param {*} str
 * @returns string unsupported
 */
export const extractLanguageFromString = str => {
	try {
		const language = str.split('"')[1];
		if (language) {
			return language;
		}
		handleSetToast({
			icon: 'warning-sign',
			intent: 'danger',
			message:
				'This language is not yet supported. The backend was unable to generate a graph and no graph is loaded for this project',
		});
		return 'Unsupported';
	} catch {
		handleSetToast({
			icon: 'warning-sign',
			intent: 'danger',
			message:
				'authentication error. Your server requires authentication',
		});
		return 'Unsupported';
	}
};

/**
 * process query result
 * @param {*} query_result
 * @param {*} props
 */
export const processQueryResult = (query_result, props) => {
	const {
		query,
		project: parsed_project,
		workspace: parsed_workspace,
		result,
	} = query_result;

	if (query.startsWith(manCommands.delete) &amp;&amp; result.stdout) {
		// if delete query
		const query = {
			query: 'workspace',
			origin: 'workspace',
			ignore: true,
		};
		props.enQueueQuery(query);
	} else if (query === manCommands.cpgLanguage &amp;&amp; result.stdout) {
		// if language query
		const workspace_name_and_active_project =
			extractWorkSpaceNameAndActiveProject(parsed_project);

		workspace_name_and_active_project.language = extractLanguageFromString(
			result.stdout,
		);

		let { workspace } = props;
		workspace = modifyWorkSpaceNameAndActiveProject(
			workspace_name_and_active_project,
			workspace,
		);
		props.setWorkSpace(workspace);
	} else if (query === 'project' &amp;&amp; (result.stdout || result.stderr)) {
		// if project query
		const parsed_project = parseProject(result);

		props.setProjects(parsed_workspace.projects);
		let { workspace } = props;
		workspace.projects = parsed_workspace.projects;

		const workspace_name_and_active_project =
			extractWorkSpaceNameAndActiveProject(parsed_project);
		workspace = modifyWorkSpaceNameAndActiveProject(
			workspace_name_and_active_project,
			workspace,
		);

		props.setWorkSpace(workspace);
	} else if (query === 'workspace' &amp;&amp; result.stdout) {
		// if workspace query
		const parsed_projects = parseProjects(result);

		let { workspace } = props;
		workspace.projects = parsed_projects;

		const workspace_name_and_active_project =
			extractWorkSpaceNameAndActiveProject(parsed_project);
		workspace = modifyWorkSpaceNameAndActiveProject(
			workspace_name_and_active_project,
			workspace,
		);

		props.setWorkSpace(workspace);
	} else if (parsed_project) {
		// if any other query with parsed project in result
		const workspace_name_and_active_project =
			extractWorkSpaceNameAndActiveProject(parsed_project);
		let { workspace } = props;
		workspace = modifyWorkSpaceNameAndActiveProject(
			workspace_name_and_active_project,
			workspace,
		);

		props.setWorkSpace(workspace);
	} else if (parsed_workspace) {
		// if any other query with  parsed workspace in result
		props.setProjects(parsed_workspace.projects);
	}
};

/**
 * Show if query result will be processed
 * @param {*} results
 * @returns latest result
 */
export const shouldProcessQueryResult = results => {
	const latest =
		results[Object.keys(results)[Object.keys(results).length - 1]];
	if (latest?.project || latest?.workspace) {
		return latest;
	}
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addRemoveKeyDownKeyUpEvent">addRemoveKeyDownKeyUpEvent</a></li><li><a href="global.html#addToQueue">addToQueue</a></li><li><a href="global.html#addToScriptsQueue">addToScriptsQueue</a></li><li><a href="global.html#areResultsEqual">areResultsEqual</a></li><li><a href="global.html#closeDialog">closeDialog</a></li><li><a href="global.html#closeFile">closeFile</a></li><li><a href="global.html#collectSettingsValues">collectSettingsValues</a></li><li><a href="global.html#constructInputToWrite">constructInputToWrite</a></li><li><a href="global.html#constructOutputToWrite">constructOutputToWrite</a></li><li><a href="global.html#contructQueryWithPath">contructQueryWithPath</a></li><li><a href="global.html#countQueries">countQueries</a></li><li><a href="global.html#createFolderJsonModel">createFolderJsonModel</a></li><li><a href="global.html#discardDialogHandler">discardDialogHandler</a></li><li><a href="global.html#editorDidMount">editorDidMount</a></li><li><a href="global.html#editorShouldGoToLine">editorShouldGoToLine</a></li><li><a href="global.html#extractLanguageFromString">extractLanguageFromString</a></li><li><a href="global.html#extractWorkSpaceNameAndActiveProject">extractWorkSpaceNameAndActiveProject</a></li><li><a href="global.html#forEachNode">forEachNode</a></li><li><a href="global.html#forNodeAtPath">forNodeAtPath</a></li><li><a href="global.html#fsToJson">fsToJson</a></li><li><a href="global.html#generateScriptImportQuery">generateScriptImportQuery</a></li><li><a href="global.html#getEditorFilesFromOpenFiles">getEditorFilesFromOpenFiles</a></li><li><a href="global.html#getExtension">getExtension</a></li><li><a href="global.html#getFolderStructureRootPathFromWorkspace">getFolderStructureRootPathFromWorkspace</a></li><li><a href="global.html#getOpenFileName">getOpenFileName</a></li><li><a href="global.html#getResultObjWithPostQueryKey">getResultObjWithPostQueryKey</a></li><li><a href="global.html#getRoot">getRoot</a></li><li><a href="global.html#getScriptResult">getScriptResult</a></li><li><a href="global.html#getSettingsInitialValues">getSettingsInitialValues</a></li><li><a href="global.html#getUIIgnoreArr">getUIIgnoreArr</a></li><li><a href="global.html#getWindowHeight">getWindowHeight</a></li><li><a href="global.html#goToLine">goToLine</a></li><li><a href="global.html#handleAddQueryToHistory">handleAddQueryToHistory</a></li><li><a href="global.html#handleAPIQueryError">handleAPIQueryError</a></li><li><a href="global.html#handleCloseProject">handleCloseProject</a></li><li><a href="global.html#handleDeleteProject">handleDeleteProject</a></li><li><a href="global.html#handleDiscard">handleDiscard</a></li><li><a href="global.html#handleEditorOnChange">handleEditorOnChange</a></li><li><a href="global.html#handleEmptyWorkspace">handleEmptyWorkspace</a></li><li><a href="global.html#handleFontSizeChange">handleFontSizeChange</a></li><li><a href="global.html#handleInitialTableWidth">handleInitialTableWidth</a></li><li><a href="global.html#handleInsertELementToCircuitUIResponseNode">handleInsertELementToCircuitUIResponseNode</a></li><li><a href="global.html#handleMaximize">handleMaximize</a></li><li><a href="global.html#handleMouseDown">handleMouseDown</a></li><li><a href="global.html#handleMouseOut">handleMouseOut</a></li><li><a href="global.html#handleMouseOver">handleMouseOver</a></li><li><a href="global.html#handleMove">handleMove</a></li><li><a href="global.html#handleOnChange">handleOnChange</a></li><li><a href="global.html#handleOpenFile">handleOpenFile</a></li><li><a href="global.html#handleOpenProject">handleOpenProject</a></li><li><a href="global.html#handleResize">handleResize</a></li><li><a href="global.html#handleSave">handleSave</a></li><li><a href="global.html#handleScrollTop">handleScrollTop</a></li><li><a href="global.html#handleShortcut">handleShortcut</a></li><li><a href="global.html#handleSuggestionClick">handleSuggestionClick</a></li><li><a href="global.html#handleSwitchWorkspace">handleSwitchWorkspace</a></li><li><a href="global.html#handleTerminalToggle">handleTerminalToggle</a></li><li><a href="global.html#handleToggleAllBlocks">handleToggleAllBlocks</a></li><li><a href="global.html#handleToggleAllSubBlocks">handleToggleAllSubBlocks</a></li><li><a href="global.html#handleToggleBlock">handleToggleBlock</a></li><li><a href="global.html#handleToggleSubBlock">handleToggleSubBlock</a></li><li><a href="global.html#handleWebSocketResponse">handleWebSocketResponse</a></li><li><a href="global.html#handleWriteQuery">handleWriteQuery</a></li><li><a href="global.html#handleWriteQueryResult">handleWriteQueryResult</a></li><li><a href="global.html#handleWriteScriptQuery">handleWriteScriptQuery</a></li><li><a href="global.html#handleWriteToCircuitUIInput">handleWriteToCircuitUIInput</a></li><li><a href="global.html#handleWriteToCircuitUIResponse">handleWriteToCircuitUIResponse</a></li><li><a href="global.html#highlightRange">highlightRange</a></li><li><a href="global.html#initCircuitUI">initCircuitUI</a></li><li><a href="global.html#initShortcuts">initShortcuts</a></li><li><a href="global.html#initXterm">initXterm</a></li><li><a href="global.html#isCtrlKeyPressed">isCtrlKeyPressed</a></li><li><a href="global.html#isCtrlKeyUnpressed">isCtrlKeyUnpressed</a></li><li><a href="global.html#isFilePathInQueryResult">isFilePathInQueryResult</a></li><li><a href="global.html#isLineNumberInQueryResult">isLineNumberInQueryResult</a></li><li><a href="global.html#isQueryResultToOpenSynthFile">isQueryResultToOpenSynthFile</a></li><li><a href="global.html#isScriptQueryResultToOpenSynthFile">isScriptQueryResultToOpenSynthFile</a></li><li><a href="global.html#modifyWorkSpaceNameAndActiveProject">modifyWorkSpaceNameAndActiveProject</a></li><li><a href="global.html#mouseTrapGlobalBindig">mouseTrapGlobalBindig</a></li><li><a href="global.html#nFormatter">nFormatter</a></li><li><a href="global.html#openEmptyFile">openEmptyFile</a></li><li><a href="global.html#openProjectExists">openProjectExists</a></li><li><a href="global.html#openShortcutsPage">openShortcutsPage</a></li><li><a href="global.html#openSyntheticFile">openSyntheticFile</a></li><li><a href="global.html#parseKeyBinding">parseKeyBinding</a></li><li><a href="global.html#parseProject">parseProject</a></li><li><a href="global.html#parseProjects">parseProjects</a></li><li><a href="global.html#parseScriptReportJSON">parseScriptReportJSON</a></li><li><a href="global.html#performDeQueueQuery">performDeQueueQuery</a></li><li><a href="global.html#performEnQueueQuery">performEnQueueQuery</a></li><li><a href="global.html#performPeekQueue">performPeekQueue</a></li><li><a href="global.html#performPostQuery">performPostQuery</a></li><li><a href="global.html#performPushResult">performPushResult</a></li><li><a href="global.html#processFiles">processFiles</a></li><li><a href="global.html#processQueryResult">processQueryResult</a></li><li><a href="global.html#processScriptResult">processScriptResult</a></li><li><a href="global.html#refreshOpenFiles">refreshOpenFiles</a></li><li><a href="global.html#registerQueryShortcut">registerQueryShortcut</a></li><li><a href="global.html#removeShortcuts">removeShortcuts</a></li><li><a href="global.html#resizeHandler">resizeHandler</a></li><li><a href="global.html#runQueryWithArgs">runQueryWithArgs</a></li><li><a href="global.html#saveFile">saveFile</a></li><li><a href="global.html#selectFolderStructureRootPath">selectFolderStructureRootPath</a></li><li><a href="global.html#sendQueryResultToXTerm">sendQueryResultToXTerm</a></li><li><a href="global.html#sendWindowsMessage">sendWindowsMessage</a></li><li><a href="global.html#setQueryResult">setQueryResult</a></li><li><a href="global.html#setSuggestionBoxTrackerContent">setSuggestionBoxTrackerContent</a></li><li><a href="global.html#shouldAlertScriptRunSuccessful">shouldAlertScriptRunSuccessful</a></li><li><a href="global.html#shouldProcessQueryResult">shouldProcessQueryResult</a></li><li><a href="global.html#shouldRunQuery">shouldRunQuery</a></li><li><a href="global.html#shouldSwitchFolder">shouldSwitchFolder</a></li><li><a href="global.html#suggestQueryForXterm">suggestQueryForXterm</a></li><li><a href="global.html#suggestSimilarQueries">suggestSimilarQueries</a></li><li><a href="global.html#toggleScriptsArgsDialog">toggleScriptsArgsDialog</a></li><li><a href="global.html#unRegisterQueryShortcut">unRegisterQueryShortcut</a></li><li><a href="global.html#updateCursorPosition">updateCursorPosition</a></li><li><a href="global.html#updateData">updateData</a></li><li><a href="global.html#updateQueriesStats">updateQueriesStats</a></li><li><a href="global.html#withAPI">withAPI</a></li><li><a href="global.html#wsDisconnectFromServer">wsDisconnectFromServer</a></li><li><a href="global.html#wsReconnectToServer">wsReconnectToServer</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Wed Apr 20 2022 13:38:41 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
